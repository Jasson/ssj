

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.3. Go 遇到的错误 &mdash; 郎哲的随手记 V1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. Erlang 随手记" href="../erlang.html" />
    <link rel="prev" title="1.2. Go get 本地库" href="gogetlocal.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> 郎哲的随手记
          

          
          </a>

          
            
            
              <div class="version">
                V1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../GoSSJ.html">1. Go 随手记</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="unit_test.html">1.1. Go 单元测试</a><ul>
<li class="toctree-l3"><a class="reference internal" href="unit_test.html#id1">如何一个命令执行所有Go的测试代码？</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_test.html#id2">Go 单元测试基本知识</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_test.html#id3">标记单元测试结果</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_test.html#id4">Go 单元测试进阶命令</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_test.html#ginkgo">补充：ginkgo 工具</a></li>
<li class="toctree-l3"><a class="reference internal" href="unit_test.html#conf-db">我只想执行一个查询数据的语句，（单元测试涉及到 conf,DB 时需要注意的问题）</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gogetlocal.html">1.2. Go get 本地库</a><ul>
<li class="toctree-l3"><a class="reference internal" href="gogetlocal.html#go-get-ssl">go get 获取默认是 ssl 验证的</a></li>
<li class="toctree-l3"><a class="reference internal" href="gogetlocal.html#parsing-go-mod-unexpected-module-path-auth">parsing go.mod: unexpected module path “auth”</a></li>
<li class="toctree-l3"><a class="reference internal" href="gogetlocal.html#id1">另外几个错误</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">1.3. Go 遇到的错误</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">类型转换</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">时间相关</a></li>
<li class="toctree-l3"><a class="reference internal" href="#map">map与数字相关的用法</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mongo-go-driver">mongo-go-driver 连接错误</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../erlang.html">2. Erlang 随手记</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../erlang/mnesia.html">2.1. Mnesia遇到的问题</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../erlang/mnesia.html#id1">Mnesia 数据丢失（并未真正丢失，只是索引丢失）</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../vue.html">3. Vue 随手记</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../vue/knowledge.html">3.1. Vue 积累</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../vue/knowledge.html#id1">跨域</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../docker.html">4. Docker 随手记</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../docker/docker_install.html">4.1. Docker 安装</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../docker/docker_install.html#id1">镜像加速</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/docker_install.html#docker-ce">删除 Docker CE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/docker_install.html#id2">docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/docker_install.html#q-a">Q&amp;A</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../docker/aidocker.html">4.2. 阿里 Docker 服务按量付费</a></li>
<li class="toctree-l2"><a class="reference internal" href="../docker/first_go.html">4.3. docker 发布 第一个 GO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../docker/first_go.html#main-go">1.编写一个 main.go</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/first_go.html#dockerfile">2.创建一个 Dockerfile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/first_go.html#id1">3.编译镜像</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/first_go.html#id2">4.运行并创建一个容器</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../docker/docker_compose.html">4.4. docker compose</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../docker/docker_compose.html#id1">1、Docker-Compose简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/docker_compose.html#id2">2、Docker-Compose安装</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/docker_compose.html#id3">3、Docker-Compose卸载</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/docker_compose.html#id4">4、Docker-Compose命令格式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/docker_compose.html#id5">5、Docker-Compose模板文件简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/docker_compose.html#id6">6、安装Docker-Compose遇到的问题</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../docker/docker_hub.html">4.5. docker hub发布项目</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../docker/docker_hub.html#id1">上传镜像</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/docker_hub.html#id2">拉取镜像</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../docker/first_compose.html">4.6. docker-compose 发布 第一个 GO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../docker/first_compose.html#main-go">1.编写一个 main.go</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/first_compose.html#dockerfile">2.创建一个 Dockerfile</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/first_compose.html#build-sh">3.创建  build.sh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/first_compose.html#id1">3.编译镜像：</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/first_compose.html#docker-compose-yml">4.创建一个docker-compose.yml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/first_compose.html#id2">4.运行并创建一个容器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../docker/first_compose.html#ok">5.测试 OK</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../docker/docker_compose_yml.html">4.7. docker-compose.yml 解释</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools.html">5. 常用工具 随手记</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/tool.html">5.1. 常用工具 随手记</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tools/tool.html#screen">screen 配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/tool.html#restructuretext">reStructureText</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../database.html">6. 数据库 随手记</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../database/influxdb.html">6.1. InfluxDb 入门</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../database/influxdb.html#shell">shell 访问阿里</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../database/querysummery.html">6.2. InfluxDb 时间范围查询总结</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../database/querysummery.html#id1">问题：数据查不出来，查询数据少了 8 小时</a></li>
<li class="toctree-l3"><a class="reference internal" href="../database/querysummery.html#id2">时区知识点</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operation.html">7. 运维相关 随手记</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../operation/teamcity.html">7.1. TeamCity 之旅</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../operation/teamcity.html#id1">安装</a></li>
<li class="toctree-l3"><a class="reference internal" href="../operation/teamcity.html#id2">配置自动化发布</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../inspiration.html">8. 感想 随手记</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../inspiration/inspiration.html">8.1. 感想随手记</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">郎哲的随手记</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../GoSSJ.html">1. Go 随手记</a> &raquo;</li>
        
      <li>1.3. Go 遇到的错误</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="go">
<h1>1.3. Go 遇到的错误<a class="headerlink" href="#go" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>类型转换<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>类型转换:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  if !(ok &amp;&amp; token.Valid) {
return nil, errors.New(&quot;非法的token&quot;)
   }

   jwtToken := &amp;JwtToken{
      Uid: claims[&quot;uid&quot;].(string),
    Sid: claims[&quot;sid&quot;].(string),
  Iat: int64(claims[&quot;iat&quot;].(float64)),
  Exp:int64(claims[&quot;exp&quot;].(float64)),
          }
          return jwtToken, nil
  }
</pre></div>
</div>
<p>整型转换为字符串 类型转换丢失数据:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stirng</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span><span class="n">丢数据</span>
<span class="n">用下面方法解决</span>
<span class="n">userId</span>  <span class="p">:</span><span class="o">=</span>  <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">UserId</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>时间相关<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>time用法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">readTimeOut</span><span class="p">:</span><span class="o">=</span><span class="mi">1</span>
<span class="n">var</span> <span class="n">a</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">readTimeOut</span>  <span class="n">提示错误</span>
<span class="n">time</span><span class="o">.</span><span class="n">Duration</span> <span class="n">是</span> <span class="n">int64</span>
<span class="n">a</span><span class="p">:</span><span class="o">=</span><span class="n">int64</span><span class="p">(</span><span class="n">readTimeOut</span><span class="p">)</span><span class="n">也是错误</span>
 <span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">writeTimeOut</span><span class="p">)</span><span class="o">//</span><span class="n">这个</span> <span class="n">OK</span>
</pre></div>
</div>
</div>
<div class="section" id="map">
<h2>map与数字相关的用法<a class="headerlink" href="#map" title="Permalink to this headline">¶</a></h2>
<p>查看 map debug 内容
第一次 debug 看到 map 显示的内容困惑了我好长一段时间，因为前面有个索引数字 0-N，我误认为是数组</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>
<span class="kn">import</span> <span class="s">&quot;log&quot;</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span>  <span class="p">{</span>
   <span class="nx">lxw</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">)</span>
   <span class="nx">lxw</span><span class="p">[</span><span class="s">&quot;aaa&quot;</span><span class="p">]=</span><span class="s">&quot;xxx&quot;</span>
   <span class="nx">lxw</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]=</span><span class="s">&quot;valu&quot;</span>
   <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">lxw</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<img alt="../_images/mapstring.png" src="../_images/mapstring.png" />
</div>
<div class="section" id="mongo-go-driver">
<h2>mongo-go-driver 连接错误<a class="headerlink" href="#mongo-go-driver" title="Permalink to this headline">¶</a></h2>
<p>连接地址:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">10.128</span><span class="o">.</span><span class="mf">132.16</span><span class="p">:</span><span class="mi">27017</span>
</pre></div>
</div>
<p>错误信息:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">err</span><span class="p">:</span><span class="o">=</span> <span class="n">server</span> <span class="n">selection</span> <span class="n">error</span><span class="p">:</span> <span class="n">server</span> <span class="n">selection</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">current</span> <span class="n">topology</span><span class="p">:</span> <span class="p">{</span> <span class="n">Type</span><span class="p">:</span> <span class="n">ReplicaSetNoPrimary</span><span class="p">,</span> <span class="n">Servers</span><span class="p">:</span> <span class="p">[{</span> <span class="n">Addr</span><span class="p">:</span> <span class="mf">10.140</span><span class="o">.</span><span class="mf">2.18</span><span class="p">:</span><span class="mi">27017</span><span class="p">,</span> <span class="n">Type</span><span class="p">:</span> <span class="n">Unknown</span><span class="p">,</span> <span class="n">State</span><span class="p">:</span> <span class="n">Connected</span><span class="p">,</span> <span class="n">Average</span> <span class="n">RTT</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Last</span> <span class="n">error</span><span class="p">:</span> <span class="n">connection</span><span class="p">()</span> <span class="p">:</span> <span class="n">dial</span> <span class="n">tcp</span> <span class="mf">10.140</span><span class="o">.</span><span class="mf">2.18</span><span class="p">:</span><span class="mi">27017</span><span class="p">:</span> <span class="n">i</span><span class="o">/</span><span class="n">o</span> <span class="n">timeout</span> <span class="p">},</span> <span class="p">]</span> <span class="p">}</span>
</pre></div>
</div>
<p>解决方法 增加 connect=direct 参数:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>10.128.132.16:27017/?connect=direct
Regarding your comment on why using mongo shell, or PyMongo works.

This is due to the difference in connection mode. When specifying a single node, i.e. mongodb://node1:27017 in shell or PyMongo, server discovery are not being made. Instead it will attempt to connect to that single node (not as part as a replica set). The catch is that you need to connect to the primary node of the replica set to write (you have to know which one). If you would like to connect as a replica set, you have to define the replica set name.

In contrast to the mongo-go-driver, by default it would perform server discovery and attempt to connect as a replica set. If you would like to connect as a single node, then you need to specify connect=direct in the connection URI.
</pre></div>
</div>
<p><a class="reference external" href="https://ask.csdn.net/questions/1019794">参考文档</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../erlang.html" class="btn btn-neutral float-right" title="2. Erlang 随手记" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gogetlocal.html" class="btn btn-neutral" title="1.2. Go get 本地库" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019-2029, 郎哲-langzhe .

    </p>
  </div>
  <div> 备案号 <a href="http://www.beian.miit.gov.cn">京ICP备19045748</a></div>Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'V1.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>